<!DOCTYPE html>
<html lang="pt">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Contato — BrazilTrad</title>
  <link rel="stylesheet" href="css/style.css">

  <style>
    body {
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: #f1f5f4;
      padding: 40px 10px;
    }

    .container {
      max-width: 520px;
      margin: 0 auto;
      background: #fff;
      padding: 30px;
      border-radius: 14px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.07);
      text-align: center;
    }

    h1 {
      margin-bottom: 5px;
      color: #0F4C5C;
      font-size: 26px;
    }

    p.subtitle {
      margin-bottom: 25px;
      color: #444;
    }

    label {
      display: block;
      text-align: left;
      font-weight: 600;
      margin-top: 12px;
    }

    input,
    textarea {
      width: 100%;
      padding: 12px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 15px;
    }

    button {
      width: 100%;
      margin-top: 18px;
      padding: 14px;
      background: #0F4C5C;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
    }

    button:hover {
      background: #12697a;
    }

    #msgStatus {
      margin-top: 18px;
      font-weight: 600;
      text-align: center;
    }

    .success {
      color: #008f4c;
    }

    .error {
      color: #c62828;
    }

    #backBtn {
      display: none;
      margin-top: 16px;
      background: #0F4C5C;
    }
  </style>
</head>

<body>

  <div class="container">

    <h1>Contato</h1>
    <p class="subtitle">Preencha o formulário abaixo e entraremos em contacto.</p>

    <form id="contactForm">

      <label for="name">Nome *</label>
      <input type="text" id="name" name="name" required>

      <label for="email">E-mail *</label>
      <input type="email" id="email" name="email" required>

      <label for="company">Empresa (opcional)</label>
      <input type="text" id="company" name="company">

      <label for="message">Mensagem *</label>
      <textarea id="message" name="message" rows="5" required></textarea>

      <button type="submit">Enviar</button>

      <div id="msgStatus"></div>
      <button id="backBtn" onclick="history.back()">Voltar ao site</button>

    </form>
  </div>

  <script>
    document.getElementById("contactForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const form = e.target;
      const msg = document.getElementById("msgStatus");
      msg.textContent = "";
      msg.className = "";

      // Capturar os valores do Lead
      const leadName = form.name.value.trim();
      const leadEmail = form.email.value.trim();
      const company = form.company.value.trim();
      const message = form.message.value.trim();

      // AUTO-REPLY (HTML para o LEAD)
      const autoReplyHTML = `
        <html>
        <body style="font-family:Arial;padding:20px;">
          <h2 style="color:#0F4C5C;">Olá, ${leadName}!</h2>
          <p>Recebemos a sua mensagem e entraremos em contacto em breve.</p>
          <hr>
          <p style="font-size:12px;color:#777;">BrazilTrad — Exportação & Comércio Internacional</p>
        </body>
        </html>
      `;

      // E-mail interno
      const internalHTML = `
        <html><body>
          <h3>Novo contato recebido:</h3>
          <p><strong>Nome:</strong> ${leadName}</p>
          <p><strong>Email:</strong> ${leadEmail}</p>
          <p><strong>Empresa:</strong> ${company}</p>
          <p><strong>Mensagem:</strong><br>${message}</p>
        </body></html>
      `;

      // FORMDATA manual para evitar erros
      const fd = new FormData();
      fd.append("access_key", "36b646fd-5467-4ff8-8a3a-9df90aae76fe");

      // Lead recebe este email (HTML)
      fd.append("auto_reply_html", autoReplyHTML);

      // Lead é o destinatário
      fd.append("email", leadEmail);

      // Envio interno
      fd.append("from_name", "BrazilTrad Website");
      fd.append("subject", "Novo contato recebido pelo site");
      fd.append("message", internalHTML);

      // Campos opcionais
      fd.append("name", leadName);
      fd.append("company", company);

      try {
        // Web3Forms (email interno + lead)
        const r = await fetch("https://api.web3forms.com/submit", {
          method: "POST",
          body: fd
        });

        const j = await r.json();
        console.log(j);

        if (!j.success) throw new Error("web3forms failed");

        // Zoho
        const zohoData = new FormData();
        zohoData.append("Company", company);
        zohoData.append("Last Name", leadName);
        zohoData.append("Email", leadEmail);
        zohoData.append("Description", message);
        zohoData.append("Lead Source", "Contato Site");

        await fetch(
          "https://crm.zoho.com/crm/WebToLeadForm?xnQsjsdp=3fd1731c66fbf93ea4e8cba470a7d2c3236fa48b9105a4c2e169800c6460cf13&xmIwtLD=55bb49f2537e4ee9c2c0d22cdebef9a489a974853af1926bb998412b493ac61ffb6464561e419055979737b7f25d38f3&actionType=TGVhZHM=&returnURL=null",
          {
            method: "POST",
            body: zohoData
          }
        );

        msg.textContent = "Mensagem enviada com sucesso!";
        msg.classList.add("success");
        document.getElementById("backBtn").style.display = "block";
        form.reset();

      } catch (err) {
        console.error(err);
        msg.textContent = "Erro ao enviar. Tente novamente.";
        msg.classList.add("error");
      }

    });
  </script>

</body>

</html>
